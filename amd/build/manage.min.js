define(["core/config","jquery","report_forumkeywords/d3","report_forumkeywords/cloud","report_forumkeywords/Base64"],function(a,b,c,d,e){return{init:function(f,g){function h(b){c.select("#wordcloud").append("svg").attr("width",j).attr("height",k).append("g").attr("transform","translate("+j/2+","+k/2+")").selectAll("text").data(b).enter().append("text").style("font-size",function(a){return a.size+"px"}).style("font-family","Microsoft JhengHei").style("cursor","pointer").style("fill",function(a,b){return i(b)}).attr("text-anchor","middle").attr("transform",function(a){return"translate("+[a.x,a.y]+")rotate("+a.rotate+")"}).text(function(a){return a.text}).on("click",function(b){window.open(a.wwwroot+"/mod/forum/search.php?id="+g+"&search="+b.text,"_blank")})}var i=c.scaleOrdinal(c.schemeCategory10),j=parseInt(c.select("#wordcloud").style("width"),10),k=parseInt(c.select("#wordcloud").style("height"),10),l=c.max(f,function(a){return a.size}),m=c.min(f,function(a){return a.size}),n=c.scaleLinear().domain([m,l]).range([20,120]);d().size([j,k]).words(f).padding(2).rotate(function(){return 90*~~(2*Math.random())}).rotate(function(){return 0}).fontSize(function(a){return n(a.size)}).on("end",h).start(),b("#downloadpng").click(function(){var a=c.select("svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML,b="data:image/svg+xml;base64,"+e.encode(a),d=document.querySelector("canvas"),f=d.getContext("2d");f.fillStyle="white",f.fillRect(0,0,d.width,d.height);var g=new Image;g.src=b,g.onload=function(){f.drawImage(g,0,0);var a=d.toDataURL("image/png"),b=document.createElement("a");b.download="wordcloud.png",b.href=a,document.body.appendChild(b),b.click()}})}}});